>yi蓑烟雨任平生

## 性能优化

相信大部分人都讨厌一件事，那就是等待，有目标的等待还好，毫无目标的等待是最烦的。

当我打开一个网页，看着浏览器上面的状态一直在转圈圈，我就搞不明白了，是我本地的网速不够么？不对啊，100M带宽干啥不得嗖嗖的。怎么你一个破网页打不开呢。难不成我断网了？刷新一下看看，还不行。算了算了滚粗吧。

不知道大家是不是跟我一个感受，一个网页我等了你几秒你还是在转圈圈还不加载的话是不是就没有耐心等下去了，如果一个官网是这样的话，恐怕是要流失不少用户的，那么我们就需要知道怎么去提升网页的加载速度，怎么去优化前端。

### 页面级优化

**1、减少HTTP请求，合理设置缓存**

我们在浏览器中输入一个网址，需要经历下面的过程。

解析DNS -> 查找服务器IP地址 -> 与服务器建立连接 -> 向服务器发送请求 -> 服务器响应请求 -> 本地解析数据

我们每一次的http请求都要经历上述的过程，在服务器端每个http都需要启动独立的线程去处理。这些通信和服务的开销都非常大，所以减少http请求的数目能够有效提高性能

那么我们有哪些能做的呢

**合并CSS**，**合并javascript**，**合并图片**。将浏览器一次访问需要的javascript和css合并成一个文件，这样浏览器就只需要一次请求。

图片的合并像雪碧图，当页面中有多个小图片，我们可以把小图片合并成一张大图，只发起一次请求，当使用小图片时通过`background-position`属性进行获取图片的位置

对于一个网站而言，一些资源类似于logo图片啦这些更新频率是很低的，如果我们把这些更新频率很低的资源缓存在浏览器中，这样我们每次访问网站的时候不用每次都去请求所有的资源，大大减少http请求的数量


**2、压缩图片**

其实我们都知道，其实整个网站最占空间的资源就是这些图片了。那么我们在切图的时候要注意在不影响图片质量的情况下能对图片进行压缩

一般压缩图片的方法有很多，有很多软件可以压缩图片，也有一些在线压缩的网站，比如[这个](https://tinypng.com/)

图片格式的选择也很重要，一般作为背景的图片我们一般使用jpg格式的图片，但是如果需要背景透明效果的图片就需要使用png格式的图片，但是一定要注意的是png格式的图片大小是比jpg格式的图片大很多的

**3、懒加载**

懒加载并不会减少整体http请求数，但是会减少页面刚加载时候的http请求数。对于图片而言，在页面刚加载的时候只加载第一屏的图片，当用户继续往后翻滚的时候才继续加载后面的图片。这样做的好处是有些用户在浏览一个网站的时候，只会看前面一点，如果没有兴趣的话就直接关掉了，如果你让用户看的前面一点都卡的要命，那活该会造成用户流失了。

**4、调整加载CSS、javascript的位置**

页面一般在加载完CSS之后就会开始渲染界面，如果CSS放在最后加载，就会造成结构已经在页面显现了，然后突然有了样式，用户体验就比较糟糕。所以加载CSS的地方要放到head标签中去

而加载javascript又不一样了，浏览器在加载javascript的时候会阻塞整个页面的渲染，造成页面显示缓慢。所以加载javascript的位置一般放在整个结构的最底下。



### 代码级优化

页面级优化说了几点，再来说几点代码级优化吧，不知道大家有没有看过《javascript高性能》这本书，这里面介绍的很详细，我们来挑几点比较常见的来说

**1、将作用域之外的变量保存到作用域内部再进行访问**

函数在执行访问某个变量的时候，是从自己的作用域链通过一层一层的执行期上下文对象的查找直到全局作用域所在的Global对象中去，如果没有找到该变量就报错undefined，如果找到了就拿过来使用，这个过程是非常耗性能的，如果我们频繁访问一个当前作用域之外的变量，我们要将该变量保存到当前作用域内。

**2、原型方法**

当我们调用一个方法的时候，会看当前对象中有没有该方法，如果没有的话就去它的原型中去查找，一直找到Object.prototype上面去。这个过程也是非常的耗性能的。

**3、减少Dom操作**

我们之前介绍过[浏览器的渲染原理](/2017/11/03/xuanran-yuanli/index.html),我们知道了浏览器中会存在**重排**与**重绘**的机制，所以我们要尽量减少在javascript中进行Dom操作，我们可以通过给元素更改className，如果必须要进行Dom操作的话我们可以先将元素脱离文档流，更改完之后再讲元素放回去。

**4、事件委托**

比如说我们需要给一堆li都绑定一个事件，我们需要给每个li都通过addEventListener绑定事件么，不需要，请看[事件委托](/2017/10/29/js-zongjie/index.html)



还有浏览器方面的优化，比如[CDN加速](/2017/11/01/wangluo-cdn/index.html)，大家可以自行查看






>既然选择了远方，便只顾风雨兼程。

—— HandSomeTT 2017.11.08